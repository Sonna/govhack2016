# == Example input
#     {
#       "place_id": 125229,
#       "name": "Prince's Park Memorial Gates",
#       "other_names": [
#         "PRINCES PARK"
#       ],
#       "location": "PARK STREET MARYBOROUGH, Central Goldfields Shire",
#       "latitude": "-37.04245",
#       "longitude": "143.74285",
#       "municipality": "CENTRAL GOLDFIELDS SHIRE",
#       "categories": [
#         "War Memorial",
#         "Bandstand/Rotunda",
#         "Lake/ Pond",
#         "Trees of social, historic or special significance",
#         "Grandstand",
#         "Historic Landscape"
#       ],
#       "descriptions": [
#         "<FONT size=2>\r\n<P>The Prince's Park Memorial Gates, on Park Street, comprise of four memorial pillars dedicated to the servicemen of the First World War. The gates were erected by the Red Cross Society on 11th November 1928. Prince's Park is a flat, low-lying site of approximately 25.6 hectares (64 acres) bounded by Park Road, Holyrood Street, Burns Street and Earl Street. The Park was established in 1857 when Maryborough was proclaimed a municipality, making it one of Victoria's oldest recreation reserves. </P>"
#       ],
#       "honour_roll_names": [],
#       "physical_descriptions": [
#         "<FONT SIZE =2>Date Started 1874; Date Finished 1896; Storeys 0; Desc PARK;"
#       ],
#       "images": [
#         {
#           "caption": "Prince's Park Memorial Gates",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/94988"
#         },
#         {
#           "caption": "Maryb  2.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133012"
#         },
#         {
#           "caption": "Maryb  3.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133013"
#         },
#         {
#           "caption": "Maryb  4.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133014"
#         },
#         {
#           "caption": "Maryb  5.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133015"
#         },
#         {
#           "caption": "Maryb  6.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133016"
#         },
#         {
#           "caption": "Maryb  7.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133017"
#         },
#         {
#           "caption": "Maryb  8.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133018"
#         },
#         {
#           "caption": "Maryb  9.jpg",
#           "image_type": {
#             "2": "Sketch"
#           },
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/133019"
#         },
#         {
#           "caption": "Princes Park plan",
#           "image_type": null,
#           "url": "http://vhd.heritage.vic.gov.au/images/vhr/94995"
#         }
#       ],
#       "heritage_overlay_numbers": [
#         "HO166"
#       ],
#       "history": null,
#       "citation": null,
#       "signifiance": "<FONT size=2>\r\n<P>What is significant? <BR>The Prince's Park recreation reserve is a flat, low-lying site of approximately 25.6 hectares (64 acres) bounded by Park Road, Holyrood Street, Burns Street and Earl Street. The 7 hectare Lake Victoria forms a central feature and is surrounded by parkland serving a mix of active and passive recreation. The reserve is one of Victoria's oldest recreation reserves. Maryborough was proclaimed a municipality on 3 March 1857 and in September 1857 the Maryborough Cricket Club presented a petition to the Council that ground opposite Nightingale Street be reserved for the Club. In 1863 12 acres was permanently reserved and in 1895 an additional 52 acres was added to the reserve. The first grandstand, a building relocated from Market Square was moved to the Park in 1860s and in 1864 a cricket match against the English XI was held. In 1869, 62 trees were selected by Clement Hodgkinson, Assistant Commissioner of Lands and Survey. Excavation of the lake began in 1883 and Council sought advice from William Guilfoyle, Director of the Melbourne Botanic Gardens on the layout and planting, although little now remains of his work. In about 1939 the Council also obtained advice from the noted landscape designer Hugh Linaker. <BR><BR>Many improvements were made to the Park which had earlier been mined. Tree planting occurred around the oval, lake and reserve perimeter. The stone lined western drain to Wills Street was constructed in 1881, the Blackman's Lead arm (Earl Street) in 1885 and the western drain to Holyrood Street in 1886. The timber walls were replaced in 1903. Other improvements were a cast iron fence and gates 1885, which was modified in 1926 to include four stone World War 1 memorials to replace the central gate posts, a grandstand 1895, band rotunda 1905, ticket office 1908, and bridge 1909. In 1953 Coronation Park was formed when the community planted trees to commemorate the coronation of Queen Elizabeth II. Although the landscape planting has been simplified and reduced in area for sports fields, playground and a caravan park, remnants of the early lake and perimeter conifer planting remain. Within the reserve is the registered 1940 Maryborough Municipal Olympic Swimming Pool (H1319). Lake Victoria holds an important population of Freshwater Catfish which were released into the lake in about 1982. The Catfish are listed under the Flora and Fauna Guarantee Act 1988 and are classified as 'vulnerable'. <BR><BR>How is it significant? <BR>Prince's Park is of historical, architectural, aesthetic, scientific (botanical) and social significance to the state of Victoria.<BR><BR>Why is it significant?<BR>Prince's Park is historically and socially significant being one of the oldest recreation reserves in Victoria. It has long served as a public meeting place for sporting contests, community events and for passive recreation. It has been the site of sporting events since it was first used as a cricket ground in 1857, only a few years after Yarra Park (1853) and Albert Park (1855) in Melbourne. The Highland Gathering has been held on New Year's Day at the Park since 1859 and is claimed to be the longest continuous sporting event in Australia. The Park has continued to be the venue for other sporting activities and competitions. Coronation Park was formed in 1953 when the Maryborough community participated in a tree planting to commemorate the coronation of Queen Elizabeth II.<BR><BR>The 1895 Grandstand is of architectural significance as an important design of the long established and notable architectural firm, Thomas Watts and Sons. Thomas Watts (1827-1915) arrived in Victoria in 1853 and was one of the founders of the Victorian Institute of Architects in 1856 and the first Hon. Secretary. He was President in 1884-85 and in 1900. The architectural firm designed some of Victoria's most significant buildings, including Bontharambo (1858), CSR buildings (1872), Cramond House (1888), Dalmeny House (1888), Malvern House (1891-2). The Grandstand uses extensive turned wood decoration and is an early example of all timber decoration that became more widespread in late Victorian and the Edwardian period. The Grandstand is the only example of this type of building by Thomas Watts and Sons, and was modelled on the 1886 South Melbourne grandstand designed by William Elliot Wells which was destroyed by fire in 1926 and a similar grandstand at Victoria Park, Collingwood which was demolished in 1966.<BR><BR>Prince's Park is historically and aesthetically significant for its association with three important landscape designers in Victoria, Clement Hodgkinson, William Guilfoyle and Hugh Linaker although their influence and original design is now reduced. The Park includes a collection of buildings and structures now rare in Victorian reserves, the 1885 fence, and gates which was later modified to include four memorial pillars to World War I servicemen, the 1895 grandstand is on eof the earliest in Victoria and one only a few nineteenth century surviving grandstands. A band rotunda, designed by the long serving Town Clerk and Surveyor, 1887 to 1935, Henry Neville Phillips (the Phillips Gardens are named after him), erected to commemorate Maryborough's golden jubilee in 1904 and opened in 1905, and a rare 1908 ticket office, one of only three such structures in Victoria. The other two offices occur at the entrances to the Fitzroy Cricket Ground. The stone lined drain first formed in 1881, extended in 1886 and the Blackman's Lead drain (Earl Street) in 1885, and the 1909 bridge are attractively designed and crafted structures and are of historical and aesthetic importance. <BR><BR>The landscaped Lake Victoria, named in honour of Queen Victoria's golden jubilee, and formed in 1883-5 by prison labour and altered in 1982 is a significant landscape feature. The remains of three rows of Monterey Pines and a row of Weeping Willows around the waters edge forms an attractive landscape. A row of Dutch Elm trees frame the rotunda, and elms north of the grandstand and oval, and elms along the western drain and Holyrood Street, Monterey pines around the lake and along Burns Road are a major landscape feature of the reserve and of aesthetic value. The well positioned and designed buildings and structures positioned to the west side of the oval and the lake in a landscaped reserve are of importance and rare for recreation reserves in Victoria, with no other reserve having a similar collection of 1880-1910 structures. The art deco gentlemen's toilet is contemporary with the nearby registered swimming pool and is of aesthetic and architectural importance. The only similar landscaped recreation reserve in Victoria is at Benalla and on a smaller scale Melville Oval, Hamilton and neither have a collection of buildings, structures, lake and ornamental planting similar or as extensive as Prince's Park. <BR><BR>Prince's Park is of scientific (botanical) significance for the occurrence of Victoria's only recorded <I>Phoenician Juniper, Juniperus phoenicea</I>. Three Red Cedars, <I>Toona ciliata</I>, were planted about 1988 in the Park. They were propagated from an old Red Cedar in Phillips Gardens and the species is rarely cultivated in Victoria. Another uncommon tree is a fine specimen of <I>Cupressus torulosa</I> var. <I>corneyana</I> and north of the Tennis Courts is a fine stand of the Red flowering Ironbark, <I>Eucalyptus sideroxylon</I> 'Rosea'.</P>",
#       "military_categories": [],
#       "military_subcategories": [],
#       "military_conflicts": [
#         "Afghanistan 2001-",
#         "All",
#         "Boxer Rebellion (China) 1900-01",
#         "Colonial Conflicts",
#         "East Timor 1999-",
#         "First Gulf War 1990-91",
#         "First World War 1914-18",
#         "Indonesian Confrontation 1962-66",
#         "Iraq 2003-",
#         "Korean War 1950-53",
#         "Malayan Emergency 1948-60",
#         "Peacekeeping 1947-Present",
#         "Second World War 1939-45",
#         "South Africa War (Boer War) 1899-1902",
#         "Sudan Conflict 1885",
#         "Vietnam War 1962-72"
#       ],
#       "vhr_number": "H1880"
#     }

# == Run Command
#     ruby scripts/veterans_json_to_custom_json.rb
#
# == Other Notes
#     head -c 100000 data/original/veterans.json | subl
#
require 'json'
require 'ostruct'
require 'pry'

require 'bigdecimal'

def to_numeric(anything)
  num = BigDecimal.new(anything.to_s)
  if num.frac == 0
    num.to_i
  else
    num.to_f
  end
end

input_directory = "/Users/Sonna/Projects/GovHack/govhack2016/data/original"
input_filenames = [
  "veterans.json"
]

input_files = input_filenames.map { |filename| "#{input_directory}/#{filename}"}

def output_file(input_filename)
  input_filename.sub(/(geojson)$/, 'json').sub(%r(/original/), '/cleaned/')
end

input_files.each do |input_file|
  output_filename = output_file(input_file)
  raw_json_string = File.read(input_file)
  json_hash = JSON.parse(raw_json_string, object_class: OpenStruct)

  #
  # {
  #   "place_id": 125229,
  #   "name": "Prince's Park Memorial Gates",
  #   ...
  #   "latitude": "-37.04245",
  #   "longitude": "143.74285",
  #   ...
  #   "categories": [
  #     "War Memorial",
  #     "Bandstand/Rotunda",
  #     "Lake/ Pond",
  #     "Trees of social, historic or special significance",
  #     "Grandstand",
  #     "Historic Landscape"
  #   ],
  #   "descriptions": [
  #     "<FONT size=2>\r\n<P>The Prince's Park Memorial Gates, on Park Street, comprise of four memorial pillars dedicated to the servicemen of the First World War. The gates were erected by the Red Cross Society on 11th November 1928. Prince's Park is a flat, low-lying site of approximately 25.6 hectares (64 acres) bounded by Park Road, Holyrood Street, Burns Street and Earl Street. The Park was established in 1857 when Maryborough was proclaimed a municipality, making it one of Victoria's oldest recreation reserves. </P>"
  #   ],
  # }
  output = json_hash.map do |record|
    {
      id: record.place_id,
      name: record.name,
      # image: image,
      description: record.descriptions.first,
      latitude: (to_numeric(record.latitude) * 1_000_000).floor / 1_000_000.0,
      longitude: (to_numeric(record.longitude) * 1_000_000).floor / 1_000_000.0,
      tags: record.categories
    }
  end

  data = output.map(&:to_hash)

  # File.write(output_filename, JSON.generate(data))
  pretty_data = JSON.pretty_generate(data)
  File.write(output_file(output_filename), pretty_data)
end
